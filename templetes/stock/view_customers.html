{% extends 'base.html' %}
{% load static %}
{% block title %} Customer Details {% endblock %}
  
{% block content %}
<div>
    <h2>Add New Customer</h2>
<form method="POST" action="{% url 'customer_details' %}">
    {% csrf_token %}
    {{ customer_form.as_p }}
    <button type="submit">Add Customer</button>
</form>

{% if messages %}
    <ul>
        {% for message in messages %}
            <li>{{ message }}</li>
        {% endfor %}
    </ul>
{% endif %}

</div>



<div style=" width: 80%;
    padding-left:20%">
    <div style="display: flex;  padding-left:20%;">
        <div>
        
        </div>
        <div style="justify-content: center; padding-left: 20%; padding-bottom: 10px;">
            <input type="text" id="customer-search" placeholder="Search by customer name..." />
            <button id="search-button">Search</button>
        </div>

    </div>

 
    <table>
        <thead>
            <tr>
                <th>Customer Name</th>
                <th>Company</th>
                <th>Phone Number</th>
                <th>Details</th>
            </tr>
        </thead>
        <tbody id="customer-list">
            {% for customer in customers %}
            <tr>
        <td>{{ customer.name }}</td>
        <td>{{ customer.company }}</td>
        <td>{{ customer.phone_number }}</td>
      
                <td><a id="btn" style=" text-decoration: none;  " href="{% url 'generate_ledger' customer.id %}">View details</a>
                </td>
            </tr>
        {% empty %}
            <tr>
                <td colspan="4">No Customer data available.</td>
            </tr>
        {% endfor %}
        </tbody>
    </table>
</div>
    
<script>
    $(document).ready(function() {
       console.log('maderchod')
        $('#customer-search').on('input', function() {
            var query = $(this).val();  
            
            // Make an AJAX request to fetch the stock information
            $.ajax({
                url: '{% url "view_customer_search_ajax" %}',  
                method: 'GET',
                data: { 'query': query },  // Send the query to the backend
                success: function(data) {
                    $('#customer-list').html(data);
                }
            });
        });
    
        // Trigger search when the user clicks the search button
        $('#search-button').click(function() {
            var query = $('#customer-search').val();  // Get the query
            $.ajax({
                url: '{% url "view_customer_search_ajax" %}',  // URL to your AJAX view
                method: 'GET',
                data: { 'query': query },  // Send the query
                success: function(data) {
                    // Update the stock table with the filtered data
                    $('#customer-list').html(data);
                }
            });
        });
    });
    </script>
{% endblock %}
