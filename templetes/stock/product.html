{% extends 'base.html' %}
{% load static %}
{% block title %} Tirpura Store {% endblock %}

{% block content %}

<!-- <div class="main-content"> -->
<div class="form-container">
    <div class="form-box">
        <h3>Add Product</h3>
        <form method="post">
            {% csrf_token %}
            {{ product_form.as_p }}
            <button type="submit" name="product_form">Add Product</button>
        </form>

    </div>
    <div class="form-box">
        <h3>Add Purchase</h3>
        <form method="post">
            {% csrf_token %}
            {{ purchase_form.as_p }}
            <button type="submit" name="purchase_form">Add Purchase</button>
        </form>
    </div>
</div>
<h2 style="text-align: center;">Product list</h2>

<div style="justify-content: center; padding-left: 20%; padding-bottom: 10px;">
    <input type="text" id="product-search" placeholder="Search by product name..." />
    <button id="search-button">Search</button>
</div>
<table>
    <thead>
        <tr>
            <th>Name</th>
            <th>Product Code</th>
            <th>Cost Price</th>
            <th>Selling Price</th>
            <th>Details</th>
        </tr>
    </thead>
    <tbody id="product-list">
        {% for product in products %}
        <tr>
            <td>{{ product.name }}</td>
            <td>{{ product.product_code }}</td>
            <td>{{ product.cost_price}}</td>
            <td>{{ product.selling_price}}</td>
            <td><a id="btn" style=" text-decoration: none;  " href="{% url 'product_history' product.id %}">View
                    details</a>
            </td>
        </tr>
        {% empty %}
        <tr>
            <td colspan="4">No Product data available.</td>
        </tr>
        {% endfor %}
    </tbody>

</table>


</div>

<script>
$(document).ready(function() {

     $('#product-search').on('input', function() {
         var query = $(this).val();  
         
         // Make an AJAX request to fetch the stock information
         $.ajax({
             url: '{% url "view_product_search_ajax" %}',  
             method: 'GET',
             data: { 'query': query },  // Send the query to the backend
             success: function(data) {
                 $('#product-list').html(data);
             }
         });
     });
 
     // Trigger search when the user clicks the search button
     $('#search-button').click(function() {
         var query = $('#product-search').val();  // Get the query
         $.ajax({
             url: '{% url "view_product_search_ajax" %}',  // URL to your AJAX view
             method: 'GET',
             data: { 'query': query },  // Send the query
             success: function(data) {
                 // Update the stock table with the filtered data
                 $('#product-list').html(data);
             }
         });
     });
 });
 </script>
{% endblock %}